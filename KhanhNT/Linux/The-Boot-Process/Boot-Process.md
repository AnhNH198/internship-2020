# Quá trình khởi động hệ điều hành Linux

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-khoi-dong-linux.png)

__Các bước diễn ra như sau:__

| Các bước | Hành động |
| -------- | --------- |
|Bước 1|BIOS|
|Bước 2|Master Boot Record (MBR)|
|Bước 3|Boot loader|
|Bước 4|Linux Kernel được nạp và khởi chạy|
|Bước 5|Các script trong INITRD thực thi|
|Bước 6|Chương trình init được thực thi|
|Bước 7|Đăng nhập giao diện đồ họa|
|Bước 8|Đăng nhập vào hệ thống| 

## Bước 1: BIOS
- Chương trình chạy đầu tiên khi nhấn nút nguồn hoặc nút reset trên máy tính cá nhân.
- BIOS thực hiện **POST (Power-on Self-test)** có nhiệm vụ kiểm tra các thông số của các phần cứng của máy tính.
- BIOS cho phép thay đổi các thiết lập, cấu hình của nó.
- BIOS được lưu trữ trong **ROM**.
- Sau khi POST kết thúc, BIOS sẽ tìm kiếm và khởi chạy 1 hệ điều hành chứa trong các thiết bị (ví dụ như ổ cứng)

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-giai-doan-BIOS.png)

## Bước 2: Master Boot Record (MBR)
- Sau khi BIOS xác định được thiết bị lưu trữ thì BIOS sẽ đọc trong **MBR** hoặc phân vùng EFI để nạp vào bộ nhớ 1 chuong trình.
- Chương trình sẽ định vị và khởi động `boot loader` - tìm ra và nạp nhân hệ điều hành.

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-giai-doan-Master-Boot-Record.png)  

## Bước 3: Boot loader
- Linux có 2 `boot loader` phổ biến là GRUB và ISOLINUX.
- Mục đích của `boot loader`:
  + Lựa chọn hệ điều hành trên máy tính để khởi động.
  + Nạp kernel của hệ điều hành đó vào bộ nhớ và chuyển điều khiển máy tính cho kernel này.

### 3.1 Giai đoạn 1
- `Boot loader` sử dụng phương pháp `BIOS/MBR`, bộ tải khởi động nằm ở vùng đầu tiên của đĩa cứng.
- Bộ tải tìm ra phân vùng có khả năng khởi động qua bảng phân vùng.

```
corgi@corgi:~$ cat /boot/grub/grub.cfg 
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
if [ -s $prefix/grubenv ]; then
  set have_grubenv=true
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="0"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"

```

### 3.2 Giai đoạn 2
- Sau khi tìm thấy 1 phân vùng có khả năng khởi động. Màn hình hiển thị cho chúng ta chọn hệ điều hành để khởi động (trong /boot)
- Bộ nạp khởi động tải hệ điều hành vào `RAM` và chuyển quyền kiểm soát cho `RAM`.

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-giai-doan-Boot-Loader-chi-tiet.png)

## Bước 4: Linux kernel được nạp và khởi chạy
- `Boot loader` nạp 1 phiên bản dạng nén của Linux kernel.
- Nó tự giải nén và tự cài đặt lên bộ nhớ hệ thống  nơi mà có ở đó đến khi tắt máy. 

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-kernel-vao-file-sbin.png)

- Sau khi chọn kernel trong file cấu hình của `boot loader`, hệ thống sẽ tự động nạp chương trình `init` trong thư mục `/sbin`.

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-kernel.png)

## Bước 5: Các script trong INITRD thực thi
- **Mục đích INITRD**:
   + Tập chương trình được thực thi __khi Kernel vừa mới được khởi chạy__.
   + Kiểm tra phần cứng hệ thống và xác định xem kernel cần hỗ trợ thêm gì để quản lí các phần cứng đó.
   + `INITRD` có thể nạp thêm vào kernel các module hỗ trợ.
- `INITRD` kết thúc thì quá trình khởi động tiếp diễn. 

- **Initramfs image**:
   + Chứa các chương trình và tệp nhị phân

![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-giai-doan-dia-ram-Initial.png)

## Bước 6: Chương trình init được thực thi
- Khi kernel khởi chạy xong, nó sẽ call 1 chương trình tên là init
- ID=1 (`Không sử dụng lệnh kill đối với init này`)

## Bước 7: Đăng nhập giao diện đồ họa 
-Đăng nhập text mode
  + Nhập tên người dùng và mật khẩu.
- Subsystem cuối cùng được init khởi động là `X Window` - là giao diện đồ họa người dùng cho Linux. 

## Bước 8: Đăng nhập vào hệ thống.



![](https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/img/qua-trinh-boot-linux-giai-doan-Text-Mode-Login.png)

https://blogd.net/linux/qua-trinh-khoi-dong-he-dieu-hanh-linux/
