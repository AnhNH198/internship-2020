# Tìm hiểu về VXLAN
## 1. Tổng quan VXLAN
### 1.1 Đặt vấn đề
- Theo mô hình truyền thống, tất cả các trung tâm dữ liệu data center sử dụng VLAN để cô lập mạng layer 2. Do `data center` ngày càng lớn và cần mở rộng mạng layer 2 thông qua `data center` hoặc ra ngoài `data center` nên những hạn chế của VLAN là có.Ví dụ:
  + Trong `data center`, yêu cầu hàng ngàn VLAN để phân tách các dòng lưu lượng môi trường đa thuê bao cùng chia sẻ kiến trúc mạng L2/L3 trong Cloud Service Provider. Mà VLAN hạn chế 4096 là không đủ.
  + Trong mỗi server ảo, mỗi máy ảo VM yêu cầu 1 địa chỉ MAC và 1 IP riêng biệt. Do đó có hàng ngàn `MAC table entries` trên upstream switches. Đặt ra nhu cầu lớn hơn về dung lượng table của thiết bị chuyển mạch.
  + `VLAN` hạn chế trong vấn đề khoảng cách và triển khai. `VTP` có thể dùng để triển khai VLAN thông qua L2 switch nhưng VTP cũng có hạn chế.

### 1.2 Khái niệm VXLAN
  - **VXLAN(`Virtual eXtensible LANs`)**: Là giao thức `tunneling`, thuộc lớp 2 và lớp 3.
  - **VXLAN** cung cấp các dịch vụ kết nối các Ethernet end Systems và cung cấp phương tiện mở rộng LAN qua Layer 3.
  - **VLAN 802.1q** dành 12 bit để đánh `VLAN-ID`, trong khi đó **VXLAN** sử dụng 24 bit để đánh địa chỉ `VLAN-ID` => Cung cấp hơn 1 triệu ID duy nhất.
  - **VXLAN** sử dụng IP(gồm cả unicast và multicast) là phương tiện truyền.

### 1.3 Các khái niệm trong VXLAN
#### 1.3.1 VNI
- **VXLAN** hoạt động trên cơ sở hạ tầng mạng hiện có và cung cấp 1 phương tiên để mở rộng mạng Layer 2. Tóm lại **VXLAN** là 1 `mạng lớp 2 overlay trên mạng lớp 3`.
- Mỗi lớp mạng như vậy gọi là **VXLAN segment**.
- Chỉ các máy ảo trong cùng 1 **VXLAN Segment** mới có thể giao tiếp được với nhau.
- Mỗi `VXLAN segment` được xác định thông qua ID kích thước 24 bit, gọi là **VXLAN Network Identifier (VNI)** => Cho phép tối đa 16 triệu các `VXLAN segment` cùng tồn tại cùng 1 domain.

![](https://github.com/khanhnt99/thuctap012017/raw/master/TamNT/Virtualization/images/4.1.png)

#### 1.3.2 Encapsulation và VTEP
- **VXLAN** là giao thức **tunneling**, thuộc lớp 2 và lớp 3.
- **VXLAN** là công nghệ `overlay` qua lớp mạng
- **VXLAN Tunnel End Point (VTEP)** dùng để kết nối switch (hiện tại là virtual switch) đến mạng IP.
- **VTEP** nằm trong hypervisor chứa VMs.
- Chức năng của **VTEP** là đóng gói các VM traffic trong IP header để gửi qua mạng IP.

![](https://github.com/hocchudong/thuctap012017/raw/master/XuanSon/Netowork%20Protocol/images/vxlan-gre_1.png)







__Docs__
- https://github.com/hocchudong/ghichep-openvswitch/blob/master/3-ovs-gre-vxlan-lab.md
- https://github.com/khanhnt99/thuctap012017/blob/master/TamNT/Virtualization/docs/4.Tim_hieu_VXLAN.md
- https://github.com/hocchudong/thuctap012017/blob/master/XuanSon/Netowork%20Protocol/VXLAN-GRE%20Protocol.md