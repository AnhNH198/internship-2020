# LAB_VXLAN_Linux Bridge

![](https://i.ibb.co/kB21XFG/Screenshot-from-2020-11-17-15-23-53.png)

![](https://i.ibb.co/sq28FRh/Screenshot-from-2020-11-17-15-43-29.png)

## 1. Topology
### 1.1 Mô tả
- 4 máy host chạy hệ điều hành Ubuntu 18.04(đều được cài QEMU,libvirt-bin).

### 1.2 Yêu cầu
- Đặt IP cho `ens3` như trong hình vẽ.
- Trong mỗi Host tạo 2 Linux Bridge:
  + `br1 (dải 10.10.10.0/24)`: kết nối với VM trong host 
  + `br2`: gán vào interface ens3
- Sử dụng VXLAN tạo đường hầm để ping thông giữa `VM1`, `VM2`, `VM3`, `VM4`.
- `VM4` là default gateway của `VM1`, `VM2`, `VM3`. Từ `VM4` connect được tới internet.
- Sử dụng `iptables` để `VM1`, `VM2`, `VM3` đều tới được internet.

## 2. Thực hành
### 2.1 Cài đặt qemu và libvirt-bin
- `apt-get update`
- `apt-get install qemu-kvm libvirt-bin bridge-utils virt-manager -y`

```
root@linux4:~# virsh -c qemu:///system list
 Id    Name                           State
----------------------------------------------------
```
```
ip link add vxlan10 type vxlan id 42 group 239.1.1.1 dev ens3 dstport 4789 &&
#ip a flush ens3
#ip link add vxlan10 type vxlan id 42 remote 10.10.10.2 dev ens3 dstport 4789 &&
ip link set vxlan10 up &&
brctl addbr br1 &&
brctl addif br1 vxlan10 &&
ip link set br1 up &&
ip a add 10.0.0.1/24 dev br1
```



__Docs__
- https://docs.openstack.org/image-guide/obtain-images.html
- https://www.poftut.com/linux-kvm-qemu-virt-customize-tutorial/
- https://libguestfs.org/virt-customize.1.html
- https://askubuntu.com/questions/1029531/how-to-setup-a-static-ip-on-ubuntu-server-18-04
- https://programmer.help/blogs/practice-vxlan-under-linux.html
- https://github.com/weaveworks/weave/issues/2789

